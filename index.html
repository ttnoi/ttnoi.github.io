<html  class="h-100">

<head>
    <title>Luyện phát âm cùng Tổng Thống Mỹ.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body class="d-flex flex-column h-100">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <div class="container-fluid">
        <div class="row">
            <div class="col-3"></div>
            <div class="col-6 center-block text-center">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col">
                            &nbsp; <!-- padding -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <input type="text" name="keyword" id="keyword">
                            <button id="search-button" >Tìm kiếm</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            &nbsp; <!-- padding -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div class="container">
                                <div class="row">
                                    <div class="col-4">
                                        <input type="radio" name="talent" id="donald-trump" class="talentCheckbox"
                                            value="donaldtrump" checked="true">
                                        <label>Donald Trump</label>
                                    </div>

                                    <div class="col-4">
                                        <input type="radio" name="talent" id="barack-obama" class="talentCheckbox"
                                            value="barackobama">
                                        <label>Barack Obama</label>
                                    </div>

                                    <div class="col-4">
                                        <input type="radio" name="talent" id="hillary-clinton" class="talentCheckbox"
                                            value="hillaryclinton">
                                        <label>Hillary Clinton</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            &nbsp; <!-- padding -->
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <!-- 1. The widget will replace this <div> tag. -->
                            <div id="search-content"></div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            &nbsp;
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div id="GATA-suggestion"  style="background-color: rgba(0, 0, 0, 0.05);" class="jumbotron d-none">
                            </div>                            
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            &nbsp;
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            <div id="share">
                                <span id="share-url"></span>&nbsp;<button id="share-button">Copy để chia sẻ</button>
                            </div>
                            <div class="alert alert-success d-none" id="success-copying-alert"  role="alert">
                                <strong>Đã copy url.</strong>
                              </div>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            &nbsp;
                        </div>
                    </div>

                    <div class="row">
                        <div class="col">
                            comment system
                        </div>
                    </div>
                    <div class="row">
                        <div class="col">
                            &nbsp;
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-3"></div>
        </div>

    </div>
    <footer class="footer mt-auto bg-body-tertiary text-center text-lg-start">
        <!-- Copyright -->
        <div class="text-center p-3" style="background-color: rgba(0, 0, 0, 0.05);">
          © 2024 Bản quyền:
          <a class="text-body" href="https://ttnoi.com/">ttnoi.com</a>
        </div>
        <!-- Copyright -->
      </footer>
    <script>
        const WEBSITE_URL = "https://ttnoi.com";
        const GATA_ON_GOOGLE_PLAY_URL = "https://bit.ly/gata-on-google-play-6381";

        // 2. This code loads the widget API code asynchronously.
        var tag = document.createElement('script');

        tag.src = "https://youglish.com/public/emb/widget.js";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        // 3. This function creates a widget after the API code downloads.
        var widget;
        function onYouglishAPIReady() {
            widget = new YG.Widget("search-content", {
                components: 8 + 64, //caption(8)       
            })
        }

        // 4. Process the query
        function search(keyword, talent) {
            // 4.1 Fetch the result from Youglish
            widget.fetch(keyword + " #" + talent, "english", "us");

            // 4.2 Change title

            // 4.3 Load GATA suggestion
            updateGATASuggestion(keyword);

            // 4.4 Change share url
            updateShareUrl(keyword, talent);

            // 4.5 Load comment system


        }

        // Querying when user 
        window.onload = function () {
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const preDefinedKeyword = urlParams.get('keyword');
            const preDefinedTalent = urlParams.get('talent');

            switch (preDefinedTalent) {
                case "donaldtrump":
                    document.getElementById("donald-trump").checked = true;
                    break;
                case "barackobama":
                    document.getElementById("barack-obama").checked = true;
                    break;
                case "hillaryclinton":
                    document.getElementById("hillary-clinton").checked = true;
                    break;
            }

            if (preDefinedKeyword != null && preDefinedKeyword != "") {
                document.getElementById("keyword").value = preDefinedKeyword;
                document.getElementById("search-button").click();
            } else {
                initializeShareUrl();
            }
        }
        
        // Querying when user presses "enter" on the keyword textbox.
        document.getElementById("keyword").addEventListener("keydown", function (event) {
            if (event.key === "Enter") {
                document.getElementById("search-button").click();
            }
        });


        // Querying when user presses the "Tim kiem" button.
        document.getElementById("search-button").onclick = function () {
            var keyword = document.getElementById("keyword").value;
            var talent = document.querySelector('.talentCheckbox:checked').value;
            if (keyword != null && keyword != "" && talent != null) {
                search(keyword, talent);
            }
        };

        // Querying when user rechecks to other checkbox.
        document.getElementById('donald-trump').onclick = function () {
            document.getElementById("search-button").click();
        };
        document.getElementById('barack-obama').onclick = function () {
            document.getElementById("search-button").click();
        };
        document.getElementById('hillary-clinton').onclick = function () {
            document.getElementById("search-button").click();
        };

        // Click share button
        document.getElementById("share-button").onclick = function () {
            var shareUrl = document.getElementById("share-url");
            navigator.clipboard.writeText(shareUrl.textContent);

            document.getElementById("success-copying-alert").classList.remove("d-none");
            $("#success-copying-alert").fadeTo(2000, 500).slideUp(500, function() {
                $("#success-copying-alert").slideUp(500);
            });            
        }


        function initializeShareUrl() {
            var url = WEBSITE_URL;
            document.getElementById("share-url").textContent = url;
        }

        function updateShareUrl(keyword, talent) {
            var url = WEBSITE_URL + "/?talent=" + talent + "&keyword=" + keyword;
            document.getElementById("share-url").textContent = url;
        }

        function updateGATASuggestion(keyword) {

            var GATASuggestion = document.getElementById('GATA-suggestion');
            while (GATASuggestion.firstChild) {
                GATASuggestion.removeChild(GATASuggestion.firstChild);
            }
           
            var [phonetics, suggestionList] = loadSuggestionLib(keyword);
            if (suggestionList && suggestionList.length > 0) {
                if (GATASuggestion.classList.contains("d-none")) {
                    GATASuggestion.classList.remove("d-none");
                }               

                // <h1 class="display-4">hello - /həˈləʊ/</h1>
                titleTag = document.createElement("h6");
                titleTag.classList.add("display-6")
                titleContent = document.createTextNode(keyword + "  /" + phonetics + "/");
                titleTag.appendChild(titleContent);                
                GATASuggestion.appendChild(titleTag);
                
                // <p class="lead">Âm /ə/ luôn giữ vai trò thứ âm.</p>
                suggestionList.forEach(suggestion => {
                    var suggestionTag = document.createElement("p");
                    suggestionTag.classList.add("lead");
                    var suggestionText = document.createTextNode(suggestion);
                    suggestionTag.appendChild(suggestionText);
                    GATASuggestion.appendChild(suggestionTag)
                });

                // <hr class="my-4">
                var hrTag = document.createElement("hr");
                hrTag.classList.add("my-4");
                GATASuggestion.appendChild(hrTag);

                // <p>Trích nối dung trong ứng dụng GATA: Học phát âm tiếng Anh.</p>
                var suggestionDescTag = document.createElement("p");
                var suggestionDescText = document.createTextNode("Trích nội dung trong ứng dụng GATA: Học phát âm tiếng Anh.");
                suggestionDescTag.appendChild(suggestionDescText);
                GATASuggestion.appendChild(suggestionDescTag);
                
                //  <p class="lead">
                //      <button id = "">GATA trên Google Play</button>
                //  </p>
                var actionTag = document.createElement("p");
                actionTag.classList.add("lead");
                actionTag.classList.add("my-4");                
                var buttonTag = document.createElement("button");
                buttonTag.onclick = function(){
                    window.open(GATA_ON_GOOGLE_PLAY_URL, '_blank').focus();
                }
                buttonTag.id = "gata-google-play";
                var buttonText = document.createTextNode("GATA trên Google Play");
                buttonTag.appendChild(buttonText);
                actionTag.appendChild(buttonTag);
                GATASuggestion.appendChild(actionTag);

            } else {
                if (!GATASuggestion.classList.contains("d-none")) {
                    GATASuggestion.classList.add("d-none");
                }
            }
        }

        function loadSuggestionLib(keyword) {
            var proDict = {
                hello: "həˈləʊ",
                love: "lʌv",
            }
            var suggestionDict = {
                ə: "Âm /ə/ luôn phát âm với vai trò thứ âm - không phải trọng âm.",
                v: "Âm /v/ abc",
            }
            var suggestionList = [];

            var phonetics = proDict[keyword];
            if (phonetics && phonetics != "") {
                phonemeList = tokenizer(phonetics);
                if (phonemeList && phonemeList.length > 0) {
                    phonemeList.forEach(phoneme => {
                        var suggestion = suggestionDict[phoneme];
                        if (suggestion != null && suggestion != "") {
                            suggestionList.push(suggestion);
                        }
                    });
                }
            }

            return [phonetics, suggestionList];
        }

        function tokenizer(phonetics) {
            return ["h", "ə", "l", "əʊ"];
        };

    </script>
</body>

</html>